<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årea do Motorista - LisboaGo</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23006600'><path d='M20 9h-9V4H5c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7c0-1.1-.9-2-2-2zm-7 6H7v-2h6v2zm4-4H7V9h10v2z'/></svg>">
</head>
<body>
    <header>
        <div class="logo">
            <h1>LisboaGo</h1>
            <p>Seu T√°xi em Lisboa, Quando Precisar!</p>
        </div>
        <nav>
            <button id="btnLogout">Sair</button>
        </nav>
    </header>

    <main class="driver-main">
        <!-- Painel de informa√ß√µes do motorista (arrast√°vel) -->
        <div class="driver-info">
            <div class="drag-handle" id="dragHandle" title="Arrastar para mover"></div>
            
            <h2>Informa√ß√µes do Motorista</h2>
            
            <div class="info-card">
                <p><strong>Nome:</strong> <span id="driverName">-</span></p>
                <p><strong>Status:</strong> <span id="driverStatus">Offline</span></p>
                <p><strong>Categoria:</strong> Motorista Profissional</p>
                <p><strong>N√∫mero Celular:</strong> <span id="driverPhone">-</span></p>
                <p><strong>Carro:</strong> <span id="driverCar">-</span></p>
                <p><strong>Placa:</strong> Logan 62-QM-79</p>
                <p><strong>Data e Hora:</strong> <span id="currentDateTime">-</span></p>
            </div>
            
            <!-- Informa√ß√µes de posi√ß√£o em tempo real -->
            <div class="position-info" id="positionInfo">
                <strong>Status:</strong> <span style="color: red;">‚óè Offline</span><br>
                <strong>√öltima atualiza√ß√£o:</strong> -<br>
                <strong>Coordenadas:</strong> -
            </div>
            
            <!-- Informa√ß√µes do sistema -->
            <div class="system-info" id="systemInfo">
                <strong>Status do Sistema:</strong> ‚úÖ Online<br>
                <strong>√öltima verifica√ß√£o:</strong> <span id="lastCheck">-</span>
            </div>
            
            <div class="driver-actions">
                <button id="toggleOnline">Ficar Online</button>
                <button id="startTracking" disabled>Iniciar Rastreamento</button>
                <button id="currentLocationBtn" style="background: linear-gradient(135deg, #2196F3 0%, #1976D2 100%); color: white;">
                    üìç Minha Localiza√ß√£o
                </button>
            </div>
            
            <!-- Estat√≠sticas r√°pidas -->
            <div class="info-card" style="margin-top: 1.5rem;">
                <h3 style="color: var(--primary-color); margin-bottom: 1rem; border-bottom: 1px solid #eee; padding-bottom: 0.5rem;">
                    üìä Estat√≠sticas Hoje
                </h3>
                <p><strong>Corridas realizadas:</strong> <span id="ridesCount">0</span></p>
                <p><strong>Km percorridos:</strong> <span id="kmDriven">0 km</span></p>
                <p><strong>Tempo online:</strong> <span id="onlineTime">00:00:00</span></p>
            </div>
        </div>
        
        <!-- Mapa -->
        <div class="driver-map">
            <div id="map"></div>
            <!-- Bot√£o de localiza√ß√£o atual no mapa -->
            <button class="current-location-btn" id="mapLocationBtn" title="Centralizar na minha localiza√ß√£o">
                üìç
            </button>
        </div>
    </main>

    <!-- Loading overlay -->
    <div id="loadingOverlay" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 9999; display: flex; align-items: center; justify-content: center;">
        <div style="background: white; padding: 2rem; border-radius: 10px; text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 1rem;">‚è≥</div>
            <h3>Carregando...</h3>
            <p>Iniciando sistema de rastreamento</p>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Carregar Google Maps API com callback para initDriverMap
        function loadGoogleMaps() {
            if (!document.querySelector('script[src*="googleapis"]')) {
                const script = document.createElement('script');
                script.src = 'https://maps.googleapis.com/maps/api/js?key=AIzaSyBmc6HTJo70N_ueR1qFVgyu74v7FIl7dU4&callback=initDriverMap&libraries=geometry,places';
                script.async = true;
                script.defer = true;
                script.onerror = function() {
                    console.error('Erro ao carregar Google Maps API');
                    alert('Erro ao carregar o mapa. Verifique sua conex√£o com a internet.');
                };
                document.head.appendChild(script);
            }
        }

        // Mostrar loading
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }

        // Esconder loading
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // Iniciar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', function() {
            showLoading();
            loadGoogleMaps();
            
            // Verificar se est√° logado
            const currentDriver = sessionStorage.getItem('currentDriver');
            if (!currentDriver) {
                window.location.href = 'login.html';
                return;
            }

            // Esconder loading ap√≥s 2 segundos (ou quando o mapa carregar)
            setTimeout(hideLoading, 2000);
        });

        // Handle errors
        window.addEventListener('error', function(e) {
            console.error('Erro global:', e.error);
            hideLoading();
        });

        // Handle unhandled rejections
        window.addEventListener('unhandledrejection', function(e) {
            console.error('Promise rejeitada:', e.reason);
            hideLoading();
        });
    </script>

    <script src="auth.js"></script>
    <script src="map.js"></script>
    <script src="script.js"></script>

    <!-- Service Worker para funcionalidades offline -->
    <script>
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(function(error) {
                console.log('Service Worker registration failed:', error);
            });
        }
    </script>
</body>
</html>